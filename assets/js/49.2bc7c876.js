(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{253:function(s,t,n){"use strict";n.r(t);var a=n(1),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"启动管理员进程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动管理员进程"}},[s._v("#")]),s._v(" 启动管理员进程")]),s._v(" "),n("p",[s._v("当我们运行一个程序的时候有时需要提升到管理员权限，但是默认的C#程序的运行权限是当前用户的权限，那么怎么提升这个启动权限呢？")]),s._v(" "),n("p",[s._v("经过网上的一番搜索后，找到如下两种方式：")]),s._v(" "),n("h2",{attrs:{id:"_1-通过应用程序清单文件实现-app-mainfest"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-通过应用程序清单文件实现-app-mainfest"}},[s._v("#")]),s._v(" 1. 通过应用程序清单文件实现(app.mainfest)")]),s._v(" "),n("p",[n("strong",[s._v("创建app.mainfest的两种办法：")])]),s._v(" "),n("ol",[n("li",[s._v("第一种办法：")])]),s._v(" "),n("p",[s._v("在项目的【Properties】上添加【新建项】，弹出窗口找到【应用程序清单文件】，最后【确定】。\n"),n("img",{attrs:{src:"https://guodf.coding.me/docs//CSharp%E5%9F%BA%E7%A1%80/C%23%E5%92%8Cwindows%E7%B3%BB%E7%BB%9F%E9%82%A3%E4%BA%9B%E4%BA%8B/img/1.png",alt:""}})]),s._v(" "),n("ol",{attrs:{start:"2"}},[n("li",[s._v("第二种办法：")])]),s._v(" "),n("p",[s._v("查看项目的【属性】，在属性页找到【安全性】，然后点击【启用ClickOnce安全设置】，然后保存（ctrl+s），你会发现Preperties目录下生成了app.mainfest文件，然后再取消【启用ClickOnce安全设置】的选中状态。\n"),n("img",{attrs:{src:"https://guodf.coding.me/docs//CSharp%E5%9F%BA%E7%A1%80/C%23%E5%92%8Cwindows%E7%B3%BB%E7%BB%9F%E9%82%A3%E4%BA%9B%E4%BA%8B/img/2.png",alt:""}})]),s._v(" "),n("p",[n("strong",[s._v("创建app.mainfest文件后，打开并编辑做以下修改：")]),n("br"),s._v("\nasInvoker改为requireAdministrator\n"),n("img",{attrs:{src:"https://guodf.coding.me/docs//CSharp%E5%9F%BA%E7%A1%80/C%23%E5%92%8Cwindows%E7%B3%BB%E7%BB%9F%E9%82%A3%E4%BA%9B%E4%BA%8B/img/3.png",alt:""}})]),s._v(" "),n("h2",{attrs:{id:"_2-通过添加代码来实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-通过添加代码来实现"}},[s._v("#")]),s._v(" 2. 通过添加代码来实现")]),s._v(" "),n("div",{staticClass:"language-CSharp line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-csharp"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" System"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" System"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Collections"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Generic"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" System"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Diagnostics"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" System"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("IO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" System"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Security"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Principal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("using")]),s._v(" System"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Windows"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Forms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" Test\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Program")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// <summary>")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// The main entry point for the application.")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/// </summary>")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("STAThread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("static")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("EnableVisualStyles")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("SetCompatibleTextRenderingDefault")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("false")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WindowsIdentity")]),s._v(" identity "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" WindowsIdentity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("GetCurrent")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WindowsPrincipal")]),s._v(" principal "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WindowsPrincipal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("identity"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//判断当前用户是否为管理员")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("principal"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("IsInRole")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("WindowsBuiltInRole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Administrator"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//如果是管理员，则直接运行")]),s._v("\n                Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Run")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Form1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//创建启动对象")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProcessStartInfo")]),s._v(" startInfo "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ProcessStartInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                startInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UseShellExecute "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                startInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("WorkingDirectory "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Environment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("CurrentDirectory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                startInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("FileName "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ExecutablePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置启动动作,确保以管理员身份运行")]),s._v("\n                startInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Verb "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"runas"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                Process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("startInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//退出               ")]),s._v("\n                Application"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("Exit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);